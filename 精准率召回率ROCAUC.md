# 一文让你彻底理解准确率，精准率，召回率，真正率，假正率，ROC/AUC

ROC/AUC作为机器学习的评估指标非常重要，也是面试中经常出现的问题（80%都会问到）。其实，理解它并不是非常难，但是好多朋友都遇到了一个相同的问题，那就是：**每次看书的时候都很明白，但回过头就忘了，经常容易将概念弄混。**还有的朋友面试之前背下来了，但是一紧张大脑一片空白全忘了，导致回答的很差。

我在之前的面试过程中也遇到过类似的问题，我的面试经验是：一般笔试题遇到选择题基本都会考这个率，那个率，或者给一个场景让你选用哪个。面试过程中也被问过很多次，比如什么是AUC/ROC？横轴纵轴都代表什么？有什么优点？为什么要使用它？



我记得在我第一次回答的时候，我将准确率，精准率，召回率等概念混淆了，最后一团乱。回去以后我从头到尾梳理了一遍所有相关概念，后面的面试基本都回答地很好。**现在想将自己的一些理解分享给大家，希望读完本篇可以彻底记住ROC/AUC的概念。**



## **▌什么是性能度量？**



我们都知道机器学习要建模，但是对于模型性能的好坏（即模型的泛化能力），我们并不知道是怎样的，很可能这个模型就是一个差的模型，泛化能力弱，对测试集不能很好的预测或分类。那么如何知道这个模型是好是坏呢？我们必须有个评判的标准。**为了了解模型的泛化能力，我们需要用某个指标来衡量，这就是性能度量的意义。**有了一个指标，我们就可以对比不同模型了，从而知道哪个模型相对好，那个模型相对差，并通过这个指标来进一步调参逐步优化我们的模型。

当然，对于分类和回归两类监督学习，分别有各自的评判标准。本篇我们主要讨论与分类相关的一些指标，因为AUC/ROC就是用于分类的性能度量标准。



## **▌混淆矩阵，准确率，精准率，召回率**



**1. 混淆矩阵**

在介绍各个率之前，先来介绍一下混淆矩阵。如果我们用的是个二分类的模型，那么把预测情况与实际情况的所有结果两两混合，结果就会出现以下4种情况，就组成了**混淆矩阵**。

![img](https://pic4.zhimg.com/80/v2-94815899cc1e592cb3ccf9862e331ba0_hd.jpg)

由于1和0是数字，阅读性不好，所以我们分别用**P和N**表示1和0两种结果。变换之后为PP，PN，NP，NN，阅读性也很差，我并不能轻易地看出来预测的正确性与否。因此，为了能够更清楚地分辨各种预测情况是否正确，我们将其中一个符号修改为**T和F**，以便于分辨出结果。



**P（Positive）：**代表1

**N（Negative）：**代表0

**T（True）：**代表预测正确

**F（False）：**代表错误



按照上面的字符表示重新分配矩阵，混淆矩阵就变成了下面这样：

![img](https://pic2.zhimg.com/80/v2-995eb39e98a20a63d472989ce4e9c049_hd.jpg)



将这种表示方法总结如下，可分为两部分：

![img](https://pic2.zhimg.com/80/v2-91c7c97cfa0ffdb28f4d85118cbdb78a_hd.jpg)



因此对于这种表示方法可以这么简单的理解：**先看 ①预测结果（P/N），再根据②实际表现对比预测结果，给出判断结果（T/F）。**按这个顺序理解，这四种情况就很好记住了。



**TP：**预测为1，预测正确，即实际1

**FP：**预测为1，预测错误，即实际0

**FN：**预测为0，预测错确，即实际1

**TN：**预测为0，预测正确，即实际0



**2. 准确率**

既然是个分类指标，我们可以很自然的想到**准确率，**准确率的定义是**预测正确的结果占总样本的百分比**，其公式如下：

准确率=**(TP+TN)/(TP+TN+FP+FN)**

![img](https://pic4.zhimg.com/80/v2-492ac29bbed274a282eee069c0b63c93_hd.jpg)



虽然准确率可以判断总的正确率，但是在**样本不平衡**的情况下，并不能作为很好的指标来衡量结果。举个简单的例子，比如在一个总样本中，正样本占90%，负样本占10%，样本是严重不平衡的。对于这种情况，我们只需要将全部样本预测为正样本即可得到90%的高准确率，但实际上我们并没有很用心的分类，只是随便无脑一分而已。这就说明了：**由于样本不平衡的问题，导致了得到的高准确率结果含有很大的水分。即如果样本不平衡，准确率就会失效。**



正因为如此，也就衍生出了其它两种指标：**精准率和召回率。**



**3. 精准率**

精准率（Precision）又叫**查准率**，它是**针对预测结果**而言的，它的含义是**在所有被预测为正的样本中实际为正的样本的概率**，意思就是在预测为正样本的结果中，我们有多少把握可以预测正确，其公式如下：

精准率=**TP/(TP+FP)**

![img](https://pic2.zhimg.com/80/v2-3ee1faa3a371c7667fdca01e960dd294_hd.jpg)

> 精准率和准确率看上去有些类似，但是完全不同的两个概念。精准率代表对正样本结果中的预测准确程度，而准确率则代表整体的预测准确程度，既包括正样本，也包括负样本。



**4. 召回率**

召回率（Recall）又叫**查全率**，它是**针对原样本**而言的，它的含义是**在实际为正的样本中被预测为正样本的概率**，其公式如下：

精准率=**TP/(TP+FN)**

![img](https://pic1.zhimg.com/80/v2-5c649d8fbb03dae0703a1b70413ae82d_hd.jpg)



**召回率的应用场景：**比如拿网贷违约率为例，相对好用户，我们更关心坏用户，不能错放过任何一个坏用户。因为如果我们过多的将坏用户当成好用户，这样后续可能发生的违约金额会远超过好用户偿还的借贷利息金额，造成严重偿失。**召回率越高，代表实际坏用户被预测出来的概率越高，它的含义类似：宁可错杀一千，绝不放过一个。**



**5. 精准率和召回率的关系，F1分数**

通过上面的公式，我们发现：精准率和召回率的分子是相同，都是TP，但分母是不同的，一个是（TP+FP），一个是（TP+FN）。两者的关系可以用一个P-R图来展示：

![img](https://pic3.zhimg.com/80/v2-7b6fc2ccc254a4e66a9dbfe43c3b3e07_hd.jpg)



**如何理解P-R（查准率-查全率）这条曲线？**

有的朋友疑惑：**这条曲线是根据什么变化的？为什么是这个形状的曲线？**其实这要从排序型模型说起。拿逻辑回归举例，逻辑回归的输出是一个0到1之间的概率数字，因此，如果我们想要根据这个概率判断用户好坏的话，我们就必须定义一个**阈值**。通常来讲，逻辑回归的概率越大说明越接近1，也就可以说他是坏用户的可能性更大。比如，我们定义了阈值为0.5，即概率小于0.5的我们都认为是好用户，而大于0.5都认为是坏用户。因此，对于阈值为0.5的情况下，我们可以得到相应的一对查准率和查全率。



但问题是：**这个阈值是我们随便定义的，我们并不知道这个阈值是否符合我们的要求。**因此，为了找到一个最合适的阈值满足我们的要求，我们就必须**遍历0到1之间所有的阈值**，而每个阈值下都对应着一对查准率和查全率，从而我们就得到了这条曲线。



有的朋友又问了：**如何找到最好的阈值点呢？**首先，需要说明的是我们对于这两个指标的要求：**我们希望查准率和查全率同时都非常高。**但实际上这两个指标是一对矛盾体，无法做到双高。图中明显看到，如果其中一个非常高，另一个肯定会非常低。选取合适的阈值点要根据实际需求，比如我们想要高的查全率，那么我们就会牺牲一些查准率，在保证查全率最高的情况下，查准率也不那么低。



**F1分数**

但通常，如果想要找到二者之间的一个**平衡点**，我们就需要一个新的指标：**F1分数**。F1分数同时考虑了查准率和查全率，让二者同时达到最高，取一个平衡。F1分数的公式为 = **2\*查准率*查全率 / (查准率 + 查全率)。**我们在图中看到的平衡点就是F1分数得来的结果。



## **▌ROC/AUC的概念**



**1. 灵敏度，特异度，真正率，假正率**

在正式介绍ROC/AUC之前，我们还要再介绍两个指标，**这两个指标的选择也正是ROC和AUC可以无视样本不平衡的原因。**这两个指标分别是：**灵敏度和（1-特异度），也叫做真正率（TPR）和假正率（FPR）**。

灵敏度（Sensitivity） = **TP/(TP+FN)**

特异度（Specificity） = **TN/(FP+TN)**



- 其实我们可以发现灵敏度和召回率是一模一样的，只是名字换了而已。
- 由于我们比较关心正样本，所以需要查看有多少负样本被错误地预测为正样本，所以使用（1-特异度），而不是特异度。



真正率（TPR） = 灵敏度 = **TP/(TP+FN)**

假正率（FPR） = 1- 特异度 = **FP/(FP+TN)**



下面是真正率和假正率的示意，我们发现**TPR和FPR分别是基于实际表现1和0出发的，也就是说它们分别在实际的正样本和负样本中来观察相关概率问题。**正因为如此，所以无论样本是否平衡，都不会被影响。还是拿之前的例子，总样本中，90%是正样本，10%是负样本。我们知道用准确率是有水分的，但是用TPR和FPR不一样。这里，TPR只关注90%正样本中有多少是被真正覆盖的，而与那10%毫无关系，同理，FPR只关注10%负样本中有多少是被错误覆盖的，也与那90%毫无关系，所以可以看出：**如果我们从实际表现的各个结果角度出发，就可以避免样本不平衡的问题了，这也是为什么选用TPR和FPR作为ROC/AUC的指标的原因。**

![img](https://pic3.zhimg.com/80/v2-947f270aaae4164a14c9093859cf0cce_hd.jpg)



或者我们也可以从另一个角度考虑：**条件概率。**我们假设**X**为预测值，**Y**为真实值。那么就可以将这些指标按条件概率表示：

**精准率 = P（Y=1 | X=1）**

**召回率 = 灵敏度 = P（X=1 | Y=1）**

**特异度 = P（X=0 | Y=0）**



从上面三个公式看到：**如果我们先以实际结果为条件（召回率，特异度），那么就只需考虑一种样本，而先以预测值为条件（精准率），那么我们需要同时考虑正样本和负样本。所以先以实际结果为条件的指标都不受样本不平衡的影响，相反以预测结果为条件的就会受到影响。**



**2. ROC（接受者操作特征曲线）**

> ROC（Receiver Operating Characteristic）曲线，又称接受者操作特征曲线。该曲线最早应用于雷达信号检测领域，用于区分信号与噪声。后来人们将其用于评价模型的预测能力，ROC曲线是基于混淆矩阵得出的。



ROC曲线中的主要两个指标就是**真正率**和**假正率，**上面也解释了这么选择的好处所在。其中横坐标为假正率（FPR），纵坐标为真正率（TPR），下面就是一个标准的ROC曲线图。

![img](https://pic4.zhimg.com/80/v2-e0aaf265791ae690b514151454b63d20_hd.jpg)



**ROC曲线的阈值问题**

与前面的P-R曲线类似，ROC曲线也是通过**遍历所有阈值**来绘制整条曲线的。如果我们不断的遍历所有阈值，预测的正样本和负样本是在不断变化的，相应的在ROC曲线图中也会沿着曲线滑动。



![img](https://pic3.zhimg.com/v2-296b158ebb205a2b90d05f5d2074bbe9_b.jpg)



**如何判断ROC曲线的好坏？**

改变阈值只是不断地改变预测的正负样本数，即TPR和FPR，但是曲线本身是不会变的。那么如何判断一个模型的ROC曲线是好的呢？这个还是要回归到我们的目的：FPR表示模型虚报的响应程度，而TPR表示模型预测响应的覆盖程度。我们所希望的当然是：虚报的越少越好，覆盖的越多越好。所以总结一下就是**TPR越高，同时FPR越低（即ROC曲线越陡），那么模型的性能就越好。**参考如下动态图进行理解。

![img](https://pic4.zhimg.com/v2-4ea5d54254cf5f969095d5e12703974d_b.jpg)



**ROC曲线无视样本不平衡**

前面已经对ROC曲线为什么可以无视样本不平衡做了解释，下面我们用动态图的形式再次展示一下它是如何工作的。我们发现：**无论红蓝色样本比例如何改变，ROC曲线都没有影响。**

![img](https://pic1.zhimg.com/v2-432e490292db97f258ecf04a7b17ef1c_b.jpg)



**3. AUC（曲线下的面积）**

为了计算 ROC 曲线上的点，我们可以使用不同的分类阈值多次评估逻辑回归模型，但这样做效率非常低。幸运的是，有一种基于排序的高效算法可以为我们提供此类信息，这种算法称为**曲线下面积（Area Under Curve）**。



比较有意思的是，如果我们连接对角线，它的面积正好是0.5。对角线的实际含义是：**随机判断响应与不响应，正负样本覆盖率应该都是50%，表示随机效果。**ROC曲线越陡越好，所以理想值就是1，一个正方形，而最差的随机判断都有0.5，所以一般AUC的值是介于0.5到1之间的。



**AUC的一般判断标准**

**0.5 - 0.7：**效果较低，但用于预测股票已经很不错了

**0.7 - 0.85：**效果一般

**0.85 - 0.95：**效果很好

**0.95 - 1：**效果非常好，但一般不太可能



**AUC的物理意义**

> 曲线下面积对所有可能的分类阈值的效果进行综合衡量。曲线下面积的一种解读方式是看作模型将某个随机正类别样本排列在某个随机负类别样本之上的概率。以下面的样本为例，逻辑回归预测从左到右以升序排列：

![img](https://pic4.zhimg.com/80/v2-a8124ef5f06b689b6fe415e50a4f48c0_hd.jpg)



## **▌ROC/AUC的Python实现**



Python中我们可以调用**sklearn**机器学习库的**metrics**进行ROC和AUC的实现，简单的代码实现部分如下：

```python
from sklearn import metrics
from sklearn.metrics import auc 
import numpy as np
y = np.array([1, 1, 2, 2])  
scores = np.array([0.1, 0.4, 0.35, 0.8])  
fpr, tpr, thresholds = metrics.roc_curve(y, scores, pos_label=2)
metrics.auc(fpr, tpr) 

0.75
```

以上就是所有关于ROC和AUC的讲解和实现，auc面积是0.75。**如今的我再去面试，最希望面试官问我这个问题了，希望看过的朋友也可以彻底理解和记住ROC/AUC，以及各种指标率的概念。**



参考：
1. 机器学习，周志华
2. Python数据科学技术详解与商业实践，常国珍
3. [https://developers.google.com/machine-learning/crash-course/classification/roc-and-auc](https://link.zhihu.com/?target=https%3A//developers.google.com/machine-learning/crash-course/classification/roc-and-auc)
4. [https://lukeoakdenrayner.wordpress.com/2018/01/07/the-philosophical-argument-for-using-roc-curves/](https://link.zhihu.com/?target=https%3A//lukeoakdenrayner.wordpress.com/2018/01/07/the-philosophical-argument-for-using-roc-curves/)
